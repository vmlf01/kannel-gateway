2007-01-26  Stipe Tolj  <stolj at kannel.org>
   * gwlib/cfg.[ch]: fix memleak and revert Alex's commit on destroying the 
     hook lists in cfg_destroy(). We need to do this in a global module scope,
     so we introduce cfg_[init|shudown]().
   * gwlib/gwlib.c: call cfg_init() and cfg_shutdown() while gwlib usage.
     Thanks to Florian Bruch for pointing to this inconsistancy.

2007-01-26 Alexander Malysh <amalysh at kannel.org>
   * gwlib/log.c: converted usage of List as rwlock to real RWLock and fixed
     some deadlocks. Additionaly we now have clean memleak stack when compiled
     with memcheck.

2007-01-23  Stipe Tolj  <stolj at kannel.org>
   * gw/smsc/smsc_smpp.c, gw/ota_compiler.c, gw/wap-appl.c, gwlib/octstr.c,
     test/fakesmsc.c, test/test_[conn|list].c: fixing compiler warnings due to
     unused or uninitialized variables. NLC.

2007-01-22 Alexander Malysh <amalysh at kannel.org>
   *  doc/userguide/userguide.xml, gw/bb_store.c, gw/bb_store.h, gw/bb_store_file.c,
      gw/bb_store_spool.c, gw/bearerbox.c, gw/bearerbox.h, gwlib/cfg.def,
      test/test_store_dump.c: apllied patch that adds additinaly support for store
      spool directory.
      [Msg-ID: <op.thkqb6jxran2ed@ppc.local>]

2007-01-22 Alexander Malysh <amalysh at kannel.org>
   * gw/bb_boxc.c: implemented resend of MO/DLR messages if some box sent nack
     with ack_failed_tmp status.

2007-01-22 Alexander Malysh <amalysh at kannel.org>
   * gwlib/gwmem-native.c: reverted last Stipe's commit. It doesn do anything usefull.

2007-01-22  Stipe Tolj  <stolj at kannel.org>
   * gwlib/gwmem-native.c: segfault prevention by setting all free()ed 
     pointers to NULL. This follows the secure coding principles of CERT-CC.
     A non NULLed pointer may be containing bogus after free() and a redo
     of gw_free() and hence free() will lead to segfault eventually.
     
2007-01-22  Stipe Tolj  <stolj at kannel.org>
   * gwlib/dbpool_sqlite.c: remove gw_free() in sqlite_close_conn(), since
     sqlite's sqlite_close() will give a bogus pointer and we segfault.
   * gwlib/dbpool_sqlite3.c: same as above, also fix a deadlock while closing
     connection due to typo in while break condition.
   * test/test_dbpool.c: add sqlite3 sections to the test
   
2007-01-22  Stipe Tolj  <stolj at kannel.org>
    * test/test_charset.c: simple test checking GSM->UTF-8->GSM conversion.

2007-01-14 Alexander Malysh <amalysh at kannel.org>
    * gw/bb_smscconn.c: set smsc_running = 0 in smsc2_cleanup instead in
      router thread because so we never call smsc2_cleanup.
    * gwlib/cfg.c: fixed memleak. we should consider moving hooks to Cfg struct.

2007-01-11  Stipe Tolj  <stolj at kannel.org>
    * gwlib/cfg.def: adds config directive 'dlr-url' to smsc group to allow
      DLR bridging via HTTP SMSC type 'kannel' connections.
    * gw/smsc/smsc_http.c: adding generic DLR handling for type 'kannel',
      which allows point-to-point DLR forwarding though the whole kannel 
      instance chain. Uses 'dlr-url' to identify the DLR inbound port to the
      next kannel instance in chain.
      
2007-01-09  Stipe Tolj  <stolj at kannel.org>
    * test/decode_emimsg.c: adding a simple tool that decodes a EMI/UCP stream
      PDU and prints more readable informations about it. Thanks to Vincent.
      [Msg-Id: <1ad701c6e08d$88bee420$9600a8c0@vince>]
    
2007-01-08  Stipe Tolj  <stolj at kannel.org>
    * gwlib/mime.c: fixing segfault in MIME multipart parsing. Thanks to Paul
      for providing the patch, and Vincent and Martin for review.
      [Msg-Id: <D19E3735-BE32-4934-987A-B9D6A3BA31CB@dsmagic.com>]
      
2007-01-08  Stipe Tolj  <stolj at kannel.org>
    * */*: update LICENSE preamble block to 2007.

2007-01-08  Stipe Tolj  <stolj at kannel.org>
    * gwlib/charset.c: removing Alex's debugging octstr_dump() calls from 
      charset_utf8_to_gsm(). NLC.
    
2007-01-08  Stipe Tolj  <stolj at kannel.org>
    * gw/smsc/smsc_fake.c: enhancing the faked DLR support. Now we pass the ACK
      of the MT first to abstraction layer, in order to obtain SMSC success DLR,
      then care about the final DLR indicating success.

2007-01-08  Stipe Tolj  <stolj at kannel.org>
	* gw/dlr.h: fixing typo for DLR_SMSC_FAIL macro, obviously this is 0x16.

2007-01-07  Stipe Tolj  <stolj at kannel.org>
    * gwlib/charset.[ch]: re-add prototypes and function charset_latin1_to_gsm()
      and charset_gsm_to_latin1() for the sake of backward compatibility of 
      external boxes using Kannel core libs. This should be reviewed and merged
      into single array for latin1 and utf-8 transcoding values.

2007-01-07  Stipe Tolj  <stolj at kannel.org>
    * gw/dlr.h: adding macro DLR_IS_NOT_FINAL() for non-final DLR status mask.

2006-12-19 Alexander Malysh <amalysh at kannel.org>
    * gw/sms.c: fixed wrong length calculation for concatenated
      messages. UDH send always as octets.

2006-12-19 Alexander Malysh <amalysh at kannel.org>
    * gwlib/octstr.[ch]: fixed warning: inlining failed in call to
      'octstr_convert_printable': function body not available.

2006-12-19  Stipe Tolj  <stolj at kannel.org>
    * gw/smsc/smsc_emi.c: fix charset re-encoding for OP/53 DLR text.
      Thanks to Vincent for providing a patch.
      [Msg-Id: <2ab401c71669$8afc34b0$9600a8c0@vince>]

2006-12-14 Andreas Fink <andreas at fink.org>
    * gwlib/list.c: fix mutex locking for gwlist_sort. It was using the wrong
      mutex giving deadlocks if you did gwlist_lock(), gwlist_sort(), gwlist_unlock()
      now also unlocking the right mutex if the list length was zero.

2006-12-02  Stipe Tolj  <stolj at kannel.org>
    * gw/smsc/smpp_pdu.c: moving 'Unknown TLV' output to WARNING for the sake
      of log-file readability. User's may switch to appropriate log-level in
      case their SMPP SMSC uses a lot of vendor-specific TLVs. NLC.
      
2006-12-01  Stipe Tolj  <stolj at kannel.org>
    * gw/smsc/smsc_emi.c: some updates of references in comments. NLC.
      Thanks to Vincent for providing a patch.
      [Msg-Id: <0ac101c71542$ca5d3780$9600a8c0@vince>]
      
2006-11-29  Stipe Tolj  <stolj at kannel.org>
    * gwlib/http.c: fixing case-insensitivity for MIME/HTTP header value
      parameters. Thanks to Paul for patch and Enver for review.
      [Msg-Id: <DEF58FCA-6522-47B6-BACB-8C6A46DE6D4B@dsmagic.com>]  

2006-11-27 Andreas Fink <andreas at fink.org>
    * gwlib/list.c: fix mutex locking for gwlist_sort. It was using the wrong
      mutex giving deadlocks if you did gwlist_lock(), gwlist_sort(), gwlist_unlock()

2006-11-23  Stipe Tolj  <stolj at kannel.org>
    * gwlib/http.c: fix HTTP/1.1 keep-alive interpreation handling. We need to
      check response headers in addition to HTTP status version to see if
      server/proxy will allow us to act in persistant connection mode.

2006-11-19  Stipe Tolj  <stolj at kannel.org>
    * gw/ota_prov.c: fixing bug #356, where calltype parsing was not right.
      Thanks a lot to Richad Kotal <info@waplikace.cz> for patch.
      
2006-11-19  Stipe Tolj  <stolj at kannel.org>
    * configure[.in]: fixing bug #368 to support Oracle 10g, via 10.x instant 
      client libs and headers. Thanks to Martin.
    * gw/shared.c: added sqlite3 version output to version preamble, added
      Oracle OCI version output.
   
2006-11-19  Stipe Tolj  <stolj at kannel.org>
	* gw/bearerbox.c: resolves bug #369 by adding warning() calls for 
	  --disable-sms or --disable-wap functions, so users are aware 
	  that the function range is limited. Thanks to Martin for this patch. 
	  Some more source code beauty via indention. NLC.
	  
2006-11-18  Stipe Tolj  <stolj at kannel.org>
    * wap/wsp_headers.c: re-adding quote char (") recognizing within the 
      wsp_field_value() that isolates header values. Thanks again to Paul.
      [Msg-Id: <D594FE8B-729D-4183-BCFA-3337FE547D37@dsmagic.com>]
      
2006-11-18  Stipe Tolj  <stolj at kannel.org>
    * gwlib/mime.c: fixing bug causing segfault due to destroyed, but then
      reused Octstr pointer. Thanks to Paul for spotting this.
      [Msg-Id: <E1F2DA11-C90B-49F5-9DC7-6481F44D14C7@dsmagic.com>]

2006-11-18  Stipe Tolj  <stolj at kannel.org>
    * configure[.in]: add /usr/lib64 search path within --with-ssl block, 
      ie. FC5 on x64_64 has that lib64 layout for devel import libs.
       
2006-11-17  Stipe Tolj  <stolj at kannel.org>
    * gw/smsbox.c: allow empty message responses.
      Thanks to Colin Pitrat <colin.pitrat@bull.net> for this patch.
      [Msg-Id: <44BCDE02.4090000@bull.net>]
      
2006-11-17  Stipe Tolj  <stolj at kannel.org>
    * gw/wap_push_ppg.c: adding support to pass the 'from' source addr via
      X-Kannel-From HTTP header in the PPG request.
      Thanks to Christian Boustany <noorentertainment@yahoo.com> for this patch.
      
2006-11-17  Stipe Tolj  <stolj at kannel.org>
    * doc/userguide/userguide.xml: section describing the new 'interactive' mode
      for fakesmsc.
    * test/fakesmsc.c: adding 'interactive' mode via stdin and stdout to allow
      a more human like interaction with the fake smsc module.
      Thanks to Alejandro Guerrieri <alejandro.guerrieri@gmail.com> for patch.
      [Msg-Id: <cd6a81510610032000s2799a2c5uc2a255b15c53e899@mail.gmail.com>]

2006-11-13  Stipe Tolj  <stolj at kannel.org>
    * gw/smsc/smsc_smpp.c: relaxing the TON=1 must have >= 7 digits condition.
      According to Andreas (see reference), there can be international routable
      numbers with less then 7 digits. So we only drop a WARNING here and 
      continue with processing. 
      [Msg-Id: <0C09E1C0-D32C-41AA-AD14-4F8D849D92C4@fink.org>]
      
2006-11-11  Stipe Tolj  <stolj at kannel.org>
    * gw/bb_alog.c: also add octstr_convert_printable() if custom access-log
      formating is used.

2006-11-10  Stipe Tolj  <stolj at kannel.org>
    * gwlib/octstr.[ch]: adding function octstr_convert_printable() to allow
      a simple convertion for an Ocstr to be printed in a printable locale
      character set. Converts and non-printbale char to '.', as octstr_dump()
      does.
    * gw/bb_alog.c: ensure in bb_alog_sms() that we use octstr_convert_printable()
      before calling alog() for DC_7BIT messages that still may contain control
      sequences and hence break the "one-line-per-entry" rule.      

2006-11-03 Alexander Malysh <amalysh at kannel.org>
    * gw/bb_boxc.c: fixed message of order issue when we retry to deliver
      to smsbox. Thanks to Ben Suffolk <ben at vanilla.net> for the patch.
      [Msg-Id: <C1DA6177-EA8E-458A-9BE7-B329DEC793C3@vanilla.net>]

2006-10-31 Alexander Malysh <amalysh at kannel.org>
    * gwlib/conn.c, gwlib/http.c: fixed race condition in
      unregister/callback usage/destroy of callback data. The race is
      as follow, spotted with help of http.c:
	1 Thread				2 Thread
      1) http:conn_pool_get			1) http:check_pool_conn
      2) conn = XYZ
      3) conn_unregister
		in conn_unregister
		destroy callbackdata
						2) dict_get(conn_pool, key) -> crash
                                                   because connback data already destroyed

2006-10-26 Alexander Malysh <amalysh at kannel.org>
    * gwlib/http.c: security bug fix for http.c. We have issue when we
      use keep alive connections with our connection pool. This is scenario
      without a patch:
          1) http_start_request(..., ssl=0,certkeyfile=NULL,our_host=NULL)
          2) http_start_request(..., ssl=1,certkeyfile=XYZ,our_host=XYZ)
      in (2) we will get from conn_pool_get connection from (1)!

2006-10-13  Stipe Tolj  <stolj at kannel.org>
    * gwlib/mime.c: fixing unquoting while contructing octstr from mime object.
      Thanks to Paul for this fix.
      [Msg-Id: <121E1E3B-AADA-4FC4-956A-AE410B416EF9@dsmagic.com>]
    
2006-10-13  Stipe Tolj  <stolj at kannel.org>
    * gw/urltran.c: fxing alias support for sms-service in smsbox. Thanks to
      Vincent for analysis and patch. Also removed debugging grp_dump() from
      Alex' previous UTF-8 patch.
      [Msg-Id: <000901c6eb10$e930c750$9600a8c0@vince>]
      
2006-10-10  Stipe Tolj  <stolj at kannel.org>
    * gwlib/mime.c: fix MIME boundry check and fixup. Thanks to Paul for this.
      [Msg-Id: <443F5E2B-781C-425C-8B85-E2D7ACEAA430@dsmagic.com>]
      
2006-10-10  Stipe Tolj  <stolj at kannel.org>
    * configure[.in], gwlib/regex.h: ensure that we use the pcreposix wrapper 
      lib for POSIX.1 instead of system regex if PCRE is enabled.
   
2006-10-06 Alexander Malysh <amalysh at kannel.org>
(CB)  * gw/sms.c, gw/smsbox.c, gw/urltrans.c, gw/smsc/smsc_at.c, gw/smsc/smsc_cimd2.c,
      gw/smsc/smsc_emi.c, gw/smsc/smsc_ois.c, gw/smsc/smsc_oisd.c, gw/smsc/smsc_smpp.c,
      gw/smsc/smsc_soap.c, gwlib/charset.c, gwlib/charset.h, gwlib/latin1_to_gsm.h:
      Applied patch that converts internal kannel charset to UTF-8. Please note that
      I didn't add smsbox compatibility code, means smsbox expect text body to be 
      encoded in UTF-8 as default also MOs will be forwarded in UTF-8. It could be
      workarounded with charset cgi variable.

2006-10-02  Stipe Tolj  <stolj at kannel.org>
    * doc/userguide/userguide.xml: fix once again URL in example of 'generic'
      in order not to use '&' char.
    
2006-10-02  Stipe Tolj  <stolj at kannel.org>
    * doc/userguide/userguide.xml: fix URL in example of 'generic'
      system-type of smsc http group. Obviously brakets indicate an
      XML tag and jade doesn't like this.

2006-10-01  Stipe Tolj  <stolj at kannel.org>
    * doc/userguide/userguide.xml: fix typo delete in XML structure.
    
2006-10-01  Stipe Tolj  <stolj at kannel.org>
    * doc/userguide/userguide.xml: updating SMSC HTTP section for new
      'generic' system-type regex directives and a group example.
    * gwlib/cfg.def: adding 'status-[success|tempfail|permfail]-regex'
      to smsc group for 'generic' system-type of SMSC HTTP.
    * gw/urltranc.[ch]: adding urltrans_fill_escape_codes() to make the
      msg struct internal values available via the escape code function.
    * gw/smsc/smsc_http.c: adding the new 'generic' system-type to allow
      the usage of the escape code sequenced in send-url and regex parsing
      of HTTP response. This new system-type may handle a lot of existing
      properitary HTTP APIs of SMS gateway aggregators without the need to
      code and add the explicite HTTP API to this module.

2006-09-29  Stipe Tolj  <stolj at kannel.org>
    * test/test_urltrans.c: modified argument list for urltrans_find(), 
      according to previous patchset commit.
    
2006-09-29  Stipe Tolj  <stolj at kannel.org>
    * doc/userguide/userguide.xml: section on new 'accepted-account' and
      'accepted-account-regex' config directives for sms-service group.
	* gwlib/cfg.def: adding 'accepted-account' and 'accepted-account-regex' 
	  config directives for sms-service group.
    * gw/smsbox.c, gw/urltrans.[ch]: adding service routing based on account
      field. This allows routing of MO messages depending on the account set
      by an aggregative SMSC provider.
      Patchset submited by Alejandro Guerrieri <alejandro.guerrieri@gmail.com>
      [Msg-Id: <cd6a81510607212039g1f805f25jaba5ef4249922aa5@mail.gmail.com>]
      [Msg-Id: <cd6a81510607231933h2554dd44i9450f507bcb9f470@mail.gmail.com>]
      
2006-09-29  Stipe Tolj  <stolj at kannel.org>
    * gw/smsc/smsc_fake.c: add TODO comment to add a SMPP DLR payload text
      for a DLR returned back via fake module.
    * gw/smsc/smsc_smpp.c: obey charset more closely in msg_to_pdu(), where
      we don't call charset_latin1_to_gsm() if charset flag of msg struct
      carries the "GSM-03.38" indication. This is not yet used by smsbox, but
      may be used by external modules before we have a clean transition to
      UTF-8 as internal charset and target charset indication via msg struct's
      charset value. Also ensures now that we write a "FAILED DLR SMS" 
      access-log entry if we receive a DLR, but can't find it via handle_dlr().
    
2006-09-29  Stipe Tolj  <stolj at kannel.org>
    * gwlib/http.h: remove semicolon ';' from #define of http_receive_result(),
      otherwise the macro is not usable in regular expressions in the code.
      Thanks to Paul for pointing this out.
      [Msg-Id: <100C7857-7696-4A6F-B5E4-B5B4D1735E00@dsmagic.com>] 
     
2006-09-25  Stipe Tolj  <stolj at kannel.org>
    * Making stable release 1.4.1.
