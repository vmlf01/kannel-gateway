README for Kannel: Open Source WAP and SMS Gateway


Abstract

	This README describes Kannel, the WapIT Open Source WAP and SMS
	gateway, and how it can be used and installed.

Status of README

	Very raw draft.

Introduction

	The Kannel Open Source WAP and SMS gateway works as both an SMS
	gateway, for implementing keyword based services via GSM text
	messages, and a WAP gateway, via UDP. The SMS part is fairly
	mature, the WAP part is early in its development. In this release,
	the GET request for WML pages and WMLScript files via HTTP works,
	including compilation for WML and WMLScript to binary forms. Only
	the data call bearer (UDP) is supported, not SMS.
	
Requirements

	You need a Unix-like operating system that supports Posix threads
	(pthreads.h). We use Red Hat Linux 6.0 and 6.1 and Debian
	development ("unstable" version) systems.

Documentation

	The user manual is in the doc/userguide directory, but it is still
	very raw. Developer documentation is in the doc/arch directory.

Getting the gateway sources

	You can download the sources from
	http://www.kannel.org/sourcecode.shtml.
	
	Note that you also need the Gnome-xml library from
	http://xmlsoft.org/xml.html. That one probably requires zlib,
	depending on how it is configured. You need at least version
	1.8.7.

Compiling and installing the gateway

	See the file INSTALL for generic installation instructions.
	The short form:
	
		./configure
		touch .depend
		make depend
		make
		make bindir=/somewhere/suitable install

	You need to copy the gw/bearerbox, gw/wapbox, gw/smsbox and
	test/test_wml programs somewhere suitable.
	
	You may need to add compilations flags to configure:
	
		CFLAGS='-pthread' ./configure
	
	The above, for instance, seems to be required on FreeBSD.

	You may also give extra arguments to disable and enable certain 
	features of the build, of which the most interesting are:

		--disable-docs		Build no documentation
		--with-malloc=native	Use standard malloc implementation
		--with-malloc=check	Use checking malloc, slower but
					very useful for debugging (default)
	
	If you want to develop Kannel, you probably want to add CFLAGS
	that make your compiler use warning messages. For example, for
	GCC:
	
		CFLAGS='-Wall -O2 -g' ./configure
		
	(you may even want to use -ansi -pedantic; we don't, at least yet).

For developers only: autoconf, configure, config.status, and Makefile

	We use the GNU autoconf tool to make it easier to adapt Kannel to
	each platform. The `autoconf' program reads the file configure.in,
	and generates a corresponding shell script called configure,
	which investigates the system it runs on to see what it supports
	and what it does not. configure then reads Makefile.in and
	config.h.in and writes out Makefile, config.h, and a shell
	script config.status.
	
	If you modify configure.in, you need to run autoconf.
	
	If you modify Makefile.in or config.h.in, you need to run
	config.status.
	
	If you modify any source files to add or change any header
	includes, you need to run "make depend".
	
	You always need to run "make" (which is the same as "make all").
	
	If you have trouble building things and suspect that there is a
	problem with the Makefile, run "make clean all". If that solves
	it, report it as a bug (see the end of this README).

For developers only: adding new SMS Center protocol support

	As Kannel does not support all the SMSC protocols that exists,
	it might become necessary to add new kind of protocols, 
	including support to use mobile phones as SMSCes.

	When doing this, use file gw/smsc_interface.def as guideline on 
	how to do it. Note that we will change this interface a bit now 
	that we have a new bearerbox which can accept a better interface.
	In practise that means that new smsc protocols will not need 
	pending_message anymore, as things are handled in 2 threads.

For developers only: "make check"

	The Kannel Makefile contains a target called "check", which
	is used to run a series of automatic, non-interactive tests on
	various subsystems. 
	
	Each test program MUST stored in the `checks' subdirectory. Each
	test MUST be written either as a C program named `check_*.c'
	or a Bourne shell script named `check_*.sh'. The C programs are
	compiled by the Makefile, the shell scripts MUST be executable.

	The test programs MUST output nothing to stdout, and MUST use a
	zero exit code to indicate that the test was successful, and a
	non-zero exit code to indicate a failure of the test. This way,
	if one runs "make -s check", one can easily see which tests are
	run and which tests work.
	
	The test programs MUST output error messages to stderr and they
	MUST mention which test program and which subtest failed. In
	case of failure, they may leave log files or other auxiliary
	files, and these MUST be listed in the error messages to stderr,
	so that the user has a reasonable way to diagnose the error.
	The Makefile captures the stderr output to `check.log'.

	The tests SHOULD take a reasonable time, preferably less than
	fifteen seconds each. This way, one can run "make -s check"
	before each commit. If there is a need to run longer tests,
	then the tests need to be divided into fast and slow ones.
	
	These tests are meant to test whether subsystems mostly work,
	stress testing needs to be done separately, and tends to require
	testing against real applications.

Configuring and running the gateway

	See the user guide in doc/userguide or on the web at
	http://www.kannel.org/doc.shtml.
	
	Kannel configuration is defined in doc/userguide/newconf.txt.
	For test use, you can see sample configurations
	gw/smskannel.conf and gw/wapkannel.conf.

	See file doc/userguide/newbb.txt for further instructions for
	running the Kannel

Using the gateway with a Nokia 7110

	To configure a Nokia 7110 to use the gateway, fill in the
	following (note that you need to provide your own dialup
	line):
	
		Home page: http://www.wapit.com/~liw/hello.wml
		(or any other WML page)
		
		Connection type: continuous
		
		Connection security: off
		
		Bearer: data
		
		Dial-up number: <your dialup line>
		
		IP address: <IP number of the host running bearer box>
		
		Authentication type: normal
		
		Data call type: <analog or isdn, depending on your line>
		
		Data call speed: 9600
		
		User name: <username for your dialup line>
		
		Password: <password for your dialup line>
		
	After you have modified the profile, activate it and load the
	home page. If you use the sample page above, you should see
	"hello, world" on the screen after a few moments.

Modifications to old Kannel (0.8 and older)

	After release 0.8 Kannel architechture has been modified considerably, 
	resulting changes in basic running of the standard WAP or WAP gateway.

	In new design, there is only one configuration file (to be more exact,
	 you can have several of them, one for each kind of box, but that is
	 advanced feature, which is not very usable) for bearerbox, smsboxes
	and wapboxes. Details of that file is in doc/userguide/newconf.txt.
	As a quick reference, you just put all your old configuration files
	into same file, remove some rows and add 'group = xxx' variables into
	it.

	Moreover, there is no internal smsbox in new Kannel. So, when running 
	SMS services you MUST run separate smsbox. This is most easily done
	with Kannel as daemon, launched with init.d. See utils/ directory
	for any supplied systems.

Feedback and more information

	You may want to subscribe the announce and devel lists at
	kannel.org if you need help or want to participate in the
	development of Kannel. Send e-mail to
	
		announce-subscribe@kannel.org
		devel-subscribe@kannel.org

	(You'll get further instructions via automatic reply mails.)
